<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Shuttle">
<meta name="theme-color" content="#050a18">
<meta name="description" content="シャトルバスの時刻表・リアルタイム発車案内アプリ">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" type="image/png" href="icon.png">
<link rel="manifest" href="manifest.json">
<title>Shuttle</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
    --safe-t:env(safe-area-inset-top,0px);
    --safe-b:env(safe-area-inset-bottom,0px);
    --bg:#050a18;
    --surface:rgba(255,255,255,0.04);
    --surface2:rgba(255,255,255,0.07);
    --border:rgba(255,255,255,0.06);
    --border2:rgba(255,255,255,0.1);
    --text:rgba(255,255,255,0.92);
    --text2:rgba(255,255,255,0.5);
    --text3:rgba(255,255,255,0.25);
    --accent:var(--a1);
    --a1:#6366f1;--a2:#818cf8;--a3:#4f46e5;
    --radius:20px;
    --radius-sm:14px;
    --radius-xs:10px;
    --ease:cubic-bezier(.4,0,.2,1);
}
.mansion{--a1:#e879a0;--a2:#f0abfc;--a3:#db2777}
.station{--a1:#6366f1;--a2:#818cf8;--a3:#4f46e5}

html{background:var(--bg)}
body{
    font-family:'Inter',-apple-system,system-ui,sans-serif;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    overscroll-behavior:none;
    min-height:100dvh;
}

/* === AMBIENT GLOW === */
.glow{
    position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;
}
.glow-orb{
    position:absolute;border-radius:50%;filter:blur(100px);opacity:.18;
    transition:all 1.2s var(--ease);
}
.glow-orb:nth-child(1){
    width:60vmax;height:60vmax;top:-20%;left:-10%;
    background:var(--a1);animation:drift1 18s ease-in-out infinite alternate;
}
.glow-orb:nth-child(2){
    width:50vmax;height:50vmax;bottom:-15%;right:-10%;
    background:var(--a2);animation:drift2 22s ease-in-out infinite alternate;
}
@keyframes drift1{0%{transform:translate(0,0)}100%{transform:translate(8vw,12vh)}}
@keyframes drift2{0%{transform:translate(0,0)}100%{transform:translate(-10vw,-8vh)}}

/* === LAYOUT === */
.shell{
    position:relative;z-index:1;
    max-width:440px;margin:0 auto;
    padding:calc(var(--safe-t)+20px) 16px calc(var(--safe-b)+32px);
}
@media(display-mode:standalone){.shell{padding-top:calc(var(--safe-t)+28px)}}

/* === TOP BAR === */
.topbar{
    display:flex;justify-content:space-between;align-items:center;
    margin-bottom:28px;
}
.brand{display:flex;align-items:center;gap:10px}
.brand-icon{
    width:36px;height:36px;border-radius:10px;overflow:hidden;
    background:var(--surface2);display:flex;align-items:center;justify-content:center;
}
.brand-icon img{width:100%;height:100%;object-fit:cover}
.brand-name{font-size:16px;font-weight:800;letter-spacing:-.02em}
.topbar-right{display:flex;align-items:center;gap:10px}
.clock{
    font-size:13px;font-weight:600;font-variant-numeric:tabular-nums;
    color:var(--text2);
}
.badge{
    display:flex;align-items:center;gap:5px;
    padding:6px 12px;border-radius:99px;font-size:11px;font-weight:700;
    background:rgba(34,197,94,.12);color:#4ade80;letter-spacing:.02em;
}
.badge-dot{width:5px;height:5px;border-radius:50%;background:currentColor;animation:blink 2s ease-in-out infinite}
.badge.off{background:rgba(251,191,36,.1);color:#fbbf24}
.badge.off .badge-dot{animation:none}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* === HERO CARD === */
.hero-card{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius);
    padding:32px 20px 28px;
    text-align:center;
    position:relative;overflow:hidden;
    transition:opacity .3s var(--ease);
}
.hero-card::before{
    content:'';position:absolute;inset:0;
    background:radial-gradient(ellipse at 50% 0%,rgba(255,255,255,.03) 0%,transparent 60%);
    pointer-events:none;
}
.hero-card.fading{opacity:0}
.hero-dir{
    display:inline-flex;align-items:center;gap:6px;
    font-size:11px;font-weight:700;color:var(--accent);
    text-transform:uppercase;letter-spacing:.12em;margin-bottom:20px;
}
.hero-dir svg{width:14px;height:14px;opacity:.7}
.hero-time{
    font-size:clamp(64px,18vw,88px);font-weight:900;
    letter-spacing:-.05em;line-height:.9;
    background:linear-gradient(180deg,#fff 20%,rgba(255,255,255,.4));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.hero-time.urgent{animation:pulse-urgent 1s ease-in-out infinite}
@keyframes pulse-urgent{0%,100%{opacity:1}50%{opacity:.7}}
.hero-sub{
    margin-top:14px;font-size:15px;font-weight:500;color:var(--text2);
    display:flex;align-items:center;justify-content:center;gap:6px;
}
.hero-sub strong{
    font-size:20px;font-weight:800;color:var(--accent);
}
.hero-sub.urgent strong{font-size:24px}
.hero-sub.now{color:var(--accent);font-weight:700}
.hero-label-tomorrow{
    font-size:10px;font-weight:700;color:var(--text3);
    background:var(--surface2);padding:3px 8px;border-radius:6px;
    margin-left:4px;vertical-align:middle;letter-spacing:.04em;
}
.progress{
    width:100%;max-width:200px;height:3px;margin:20px auto 0;
    background:rgba(255,255,255,.06);border-radius:99px;overflow:hidden;
}
.progress-bar{
    height:100%;border-radius:99px;
    background:linear-gradient(90deg,var(--a3),var(--a2));
    transition:width 1s linear;
}

/* === UPCOMING ROW === */
.upcoming{
    display:flex;gap:8px;margin-top:20px;
    overflow-x:auto;scrollbar-width:none;
    justify-content:center;padding:2px;
}
.upcoming::-webkit-scrollbar{display:none}
.up-chip{
    flex-shrink:0;padding:10px 16px;
    background:var(--surface2);border:1px solid var(--border);
    border-radius:var(--radius-xs);text-align:center;
    transition:transform .15s var(--ease);
}
.up-chip:active{transform:scale(.96)}
.up-time{font-size:15px;font-weight:700;letter-spacing:-.01em}
.up-mins{font-size:10px;color:var(--text3);margin-top:2px;font-weight:600}
.up-tmrw{font-size:8px;font-weight:800;color:var(--accent);opacity:.6;margin-top:2px;letter-spacing:.06em}

/* === NO SERVICE === */
.empty{padding:40px 0;text-align:center}
.empty svg{width:48px;height:48px;color:var(--text3);margin-bottom:16px}
.empty h3{font-size:17px;font-weight:700;color:var(--text2);margin-bottom:6px}
.empty p{font-size:13px;color:var(--text3)}

/* === ROUTE TOGGLE === */
.seg{
    display:flex;gap:4px;padding:4px;margin:24px 0;
    background:var(--surface);border:1px solid var(--border);
    border-radius:var(--radius-sm);position:relative;
}
.seg-track{
    position:absolute;top:4px;left:4px;
    width:calc(50% - 4px);height:calc(100% - 8px);
    border-radius:var(--radius-xs);
    background:var(--accent);
    transition:transform .35s var(--ease),background .5s;
}
.mansion .seg-track{transform:translateX(calc(100% + 4px))}
.seg-btn{
    flex:1;position:relative;z-index:1;
    padding:12px 8px;border:none;background:none;
    font-family:inherit;font-size:13px;font-weight:700;
    color:var(--text3);cursor:pointer;
    display:flex;align-items:center;justify-content:center;gap:7px;
    transition:color .3s,transform .1s;-webkit-tap-highlight-color:transparent;
}
.seg-btn:active{transform:scale(.97)}
.seg-btn.on{color:#fff}
.seg-btn svg{width:16px;height:16px}

/* === SCHEDULE === */
.sched{
    background:var(--surface);border:1px solid var(--border);
    border-radius:var(--radius);padding:20px 16px;
    transition:opacity .3s var(--ease);
}
.sched.fading{opacity:0}
.sched-head{
    display:flex;justify-content:space-between;align-items:center;
    margin-bottom:16px;padding:0 4px;
}
.sched-head h2{font-size:12px;font-weight:800;color:var(--text3);text-transform:uppercase;letter-spacing:.1em}
.sched-head span{font-size:10px;color:var(--text3);font-weight:600}
.row{
    display:flex;align-items:center;
    padding:10px 4px;
    border-bottom:1px solid var(--border);
    transition:opacity .2s;
}
.row:last-child{border-bottom:none}
.row.past{opacity:.15}
.row.now{
    background:var(--surface2);margin:2px -8px;
    padding:10px 12px;border-radius:var(--radius-xs);border-bottom:none;
}
.row-h{
    width:44px;font-size:14px;font-weight:700;
    font-variant-numeric:tabular-nums;color:var(--text2);flex-shrink:0;
}
.row-h small{font-size:10px;font-weight:500;opacity:.5;margin-left:1px}
.row.now .row-h{color:var(--accent)}
.row-mins{display:flex;flex-wrap:wrap;gap:6px;flex:1}
.pill{
    font-size:12px;font-weight:600;font-variant-numeric:tabular-nums;
    padding:4px 8px;border-radius:6px;color:var(--text2);
    transition:all .2s;
}
.pill.gone{opacity:.2;text-decoration:line-through}
.pill.next{
    background:var(--accent);color:#fff;font-weight:800;
    box-shadow:0 2px 12px rgba(99,102,241,.3);
}
.pill.live{
    background:var(--accent);color:#fff;font-weight:800;
    animation:pill-pulse 1.5s ease-in-out infinite;
    box-shadow:0 2px 12px rgba(99,102,241,.3);
}
@keyframes pill-pulse{0%,100%{opacity:1}50%{opacity:.55}}
.row-empty{font-size:11px;color:var(--text3);font-style:italic}

/* === FLOATING BAR === */
.float-bar{
    position:fixed;top:calc(var(--safe-t)+10px);left:50%;
    transform:translateX(-50%) translateY(-24px);
    opacity:0;z-index:100;pointer-events:none;
    padding:8px 18px;
    background:rgba(5,10,24,.88);backdrop-filter:blur(24px);
    border:1px solid var(--border2);border-radius:99px;
    display:flex;align-items:center;gap:10px;
    transition:all .3s var(--ease);
    box-shadow:0 8px 32px rgba(0,0,0,.4);
}
.float-bar.show{opacity:1;transform:translateX(-50%) translateY(0)}
.fb-dir{font-size:10px;font-weight:700;color:var(--text3);padding-right:10px;border-right:1px solid var(--border2)}
.fb-time{font-size:16px;font-weight:800;letter-spacing:-.02em;color:var(--accent)}
.fb-mins{font-size:12px;font-weight:600;color:var(--text2)}

/* === PULL REFRESH === */
.ptr{
    position:fixed;top:calc(var(--safe-t) - 40px);left:50%;
    transform:translateX(-50%);z-index:200;
    width:32px;height:32px;border-radius:50%;
    background:rgba(5,10,24,.95);border:1px solid var(--border2);
    display:flex;align-items:center;justify-content:center;
    transition:top .2s,opacity .2s;opacity:0;pointer-events:none;
}
.ptr.show{opacity:1;top:calc(var(--safe-t)+14px)}
.ptr.spin svg{animation:spin .5s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="station" id="app">
    <div class="glow"><div class="glow-orb"></div><div class="glow-orb"></div></div>

    <div class="ptr" id="ptr">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
    </div>

    <div class="float-bar" id="floatBar">
        <span class="fb-dir" id="fbDir">辻堂駅</span>
        <span class="fb-time" id="fbTime">--:--</span>
        <span class="fb-mins" id="fbMins">--</span>
    </div>

    <div class="shell">
        <header class="topbar">
            <div class="brand">
                <div class="brand-icon"><img src="icon.png" alt="" onerror="this.style.display='none'"></div>
                <span class="brand-name">Shuttle</span>
            </div>
            <div class="topbar-right">
                <span class="clock" id="clock"></span>
                <div class="badge" id="badge"><span class="badge-dot"></span><span id="badgeText">運行中</span></div>
            </div>
        </header>

        <div class="hero-card" id="heroCard">
            <div id="hero"></div>
        </div>

        <div class="seg">
            <div class="seg-track"></div>
            <button class="seg-btn on" id="btnS" onclick="go('station')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16M12 3v8M8 19l-2 3M18 22l-2-3"/><circle cx="8" cy="15" r="1"/><circle cx="16" cy="15" r="1"/></svg>
                辻堂駅
            </button>
            <button class="seg-btn" id="btnM" onclick="go('mansion')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                マンション
            </button>
        </div>

        <section class="sched" id="schedCard">
            <div class="sched-head"><h2>時刻表</h2><span>平日のみ運行</span></div>
            <div id="sched"></div>
        </section>
    </div>
</div>

<script>
const DATA={
    station:{
        6:[0,15,30,45],7:[0,10,15,25,30,40,45,55],8:[0,20,40],
        9:[0,20,40],10:[0,20,40],11:[0,20,40],12:[0,20,40],13:[0],14:[],
        15:[0,20,40],16:[0,20,40],17:[0,20,40],18:[0,20,40],
        19:[0,15,30,45],20:[0,20,40],21:[0,20,40],22:[0]
    },
    mansion:{
        6:[5,20,35,50],7:[5,15,20,30,35,45,50],8:[0,5,25,45],
        9:[5,25,45],10:[5,25,45],11:[5,25,45],12:[5,25,45],13:[5],14:[],
        15:[5,25,45],16:[5,25,45],17:[5,25,45],18:[5,25,45],
        19:[5,20,35,50],20:[5,25,45],21:[5,25,45],22:[5]
    }
};
const LABELS={station:'辻堂駅',mansion:'マンション'};
const ICONS={
    station:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16M12 3v8"/></svg>',
    mansion:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>'
};

/* === HOLIDAYS === */
function jpHolidays(y){
    const s=new Set(),a=(m,d)=>s.add(`${y}-${m}-${d}`);
    a(1,1);a(2,11);a(2,23);a(4,29);a(5,3);a(5,4);a(5,5);a(8,11);a(11,3);a(11,23);
    const nm=(mo,n)=>{const f=new Date(y,mo-1,1),d=f.getDay(),fm=d<=1?1+(1-d):1+(8-d);return fm+(n-1)*7};
    a(1,nm(1,2));a(7,nm(7,3));a(9,nm(9,3));a(10,nm(10,2));
    a(3,Math.floor(20.8431+.242194*(y-1980)-Math.floor((y-1980)/4)));
    a(9,Math.floor(23.2488+.242194*(y-1980)-Math.floor((y-1980)/4)));
    for(const h of[...s]){const[,m,d]=h.split('-').map(Number);if(new Date(y,m-1,d).getDay()===0)a(m,d+1)}
    return s;
}
let hCache={};
function isOff(d){
    const y=d.getFullYear();
    if(!hCache[y])hCache[y]=jpHolidays(y);
    return d.getDay()===0||d.getDay()===6||hCache[y].has(`${y}-${d.getMonth()+1}-${d.getDate()}`);
}

/* === STATE === */
let dir=localStorage.getItem('shuttle-dir')||'station';
let now=new Date(),nextData=null;
const $=id=>document.getElementById(id);
const pad=n=>String(n).padStart(2,'0');

function nextBuses(n=4){
    const sc=DATA[dir],h=now.getHours(),m=now.getMinutes(),out=[];
    for(let hr=h;hr<=22&&out.length<n;hr++)
        for(const mn of(sc[hr]||[])){
            if(hr===h&&mn<m)continue;
            out.push({hour:hr,min:mn,now:hr===h&&mn===m});
            if(out.length>=n)break;
        }
    for(let hr=6;hr<=22&&out.length<n;hr++)
        for(const mn of(sc[hr]||[])){out.push({hour:hr,min:mn,tmrw:true});if(out.length>=n)break}
    return out;
}
function minsTo(b){
    if(b.now)return 0;
    const t=new Date(now);t.setHours(b.hour,b.min,0,0);
    if(b.tmrw)t.setDate(t.getDate()+1);
    return Math.max(0,Math.floor((t-now)/6e4));
}

/* === RENDER === */
function go(d){
    if(d===dir)return;
    dir=d;localStorage.setItem('shuttle-dir',d);
    $('app').className=d;
    $('btnS').className=`seg-btn ${d==='station'?'on':''}`;
    $('btnM').className=`seg-btn ${d==='mansion'?'on':''}`;
    if(navigator.vibrate)navigator.vibrate(10);
    fadeRender();
}

function updateClock(){$('clock').textContent=pad(now.getHours())+':'+pad(now.getMinutes())}

function renderHero(buses){
    const off=isOff(now);
    $('badge').className=`badge${off?' off':''}`;
    $('badgeText').textContent=off?'運休日':'運行中';

    if(off){
        nextData=null;
        $('hero').innerHTML=`<div class="empty">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="m4.9 4.9 14.2 14.2"/></svg>
            <h3>本日は運休です</h3><p>平日のみ運行しています</p></div>`;
        return;
    }
    if(!buses.length){
        nextData=null;
        $('hero').innerHTML=`<div class="empty">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <h3>本日の運行は終了</h3><p>始発 6:00</p></div>`;
        return;
    }
    const nx=buses[0],mins=minsTo(nx),up=buses.slice(1,4);
    const pct=Math.max(0,100-(mins/60*100));
    const urg=!nx.now&&mins<=3;
    nextData={time:pad(nx.hour)+':'+pad(nx.min),mins};

    let h=`<div class="hero-dir">${ICONS[dir]}${LABELS[dir]}</div>
        <div class="hero-time${urg?' urgent':''}">${pad(nx.hour)}:${pad(nx.min)}</div>
        <div class="hero-sub${urg?' urgent':''}${nx.now?' now':''}">`;
    if(nx.now)h+=`<strong>まもなく発車</strong>`;
    else h+=`あと <strong>${mins}</strong> 分${nx.tmrw?'<span class="hero-label-tomorrow">明日</span>':''}`;
    h+=`</div><div class="progress"><div class="progress-bar" style="width:${nx.now?100:pct}%"></div></div>`;

    if(up.length){
        h+=`<div class="upcoming">`;
        for(const b of up){
            const m=minsTo(b);
            h+=`<div class="up-chip"><div class="up-time">${pad(b.hour)}:${pad(b.min)}</div><div class="up-mins">${m}分後</div>${b.tmrw?'<div class="up-tmrw">明日</div>':''}</div>`;
        }
        h+=`</div>`;
    }
    $('hero').innerHTML=h;
    $('fbDir').textContent=LABELS[dir];
    $('fbTime').textContent=nextData.time;
    $('fbMins').textContent=nx.now?'まもなく':nextData.mins+'分';
}

function renderSched(buses){
    const sc=DATA[dir],h=now.getHours(),m=now.getMinutes();
    const nb=buses.length?buses[0]:null;
    let html='';
    for(let hr=6;hr<=22;hr++){
        const mins=sc[hr]||[];
        if(!mins.length&&(hr<10||hr>20))continue;
        const past=hr<h,cur=hr===h;
        let cls='row';if(past)cls+=' past';if(cur)cls+=' now';
        html+=`<div class="${cls}" id="r${hr}"><div class="row-h">${hr}<small>時</small></div><div class="row-mins">`;
        if(!mins.length){html+=`<span class="row-empty">—</span>`}
        else for(const mn of mins){
            const gn=past||(cur&&mn<m),live=cur&&mn===m;
            const isNx=nb&&nb.hour===hr&&nb.min===mn&&!nb.tmrw&&!live;
            let c='pill';if(gn)c+=' gone';if(live)c+=' live';if(isNx)c+=' next';
            html+=`<span class="${c}">${pad(mn)}</span>`;
        }
        html+=`</div></div>`;
    }
    $('sched').innerHTML=html;
}

function render(){
    updateClock();
    const b=nextBuses();
    renderHero(b);renderSched(b);
}

function fadeRender(){
    const hc=$('heroCard'),sc=$('schedCard');
    hc.classList.add('fading');sc.classList.add('fading');
    setTimeout(()=>{render();hc.classList.remove('fading');sc.classList.remove('fading')},280);
}

function scrollNow(){
    const r=$(`r${now.getHours()}`)||$(`r${now.getHours()+1}`);
    if(r)r.scrollIntoView({behavior:'smooth',block:'center'});
}

/* === FLOATING BAR === */
const heroCard=$('heroCard'),floatBar=$('floatBar');
function onScroll(){
    if(!nextData){floatBar.classList.remove('show');return}
    floatBar.classList.toggle('show',heroCard.getBoundingClientRect().bottom<80);
}
window.addEventListener('scroll',onScroll,{passive:true});

/* === SWIPE === */
let sx=0,sy=0;
document.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY},{passive:true});
document.addEventListener('touchend',e=>{
    const dx=e.changedTouches[0].clientX-sx,dy=e.changedTouches[0].clientY-sy;
    if(Math.abs(dx)>60&&Math.abs(dx)>Math.abs(dy)*2){
        if(dx<0&&dir==='station')go('mansion');
        else if(dx>0&&dir==='mansion')go('station');
    }
},{passive:true});

/* === PULL TO REFRESH === */
const ptr=$('ptr');let py=0,pa=false;
window.addEventListener('touchstart',e=>{if(!window.scrollY){py=e.touches[0].clientY;pa=true}},{passive:true});
window.addEventListener('touchmove',e=>{if(!pa)return;ptr.classList.toggle('show',e.touches[0].clientY-py>50&&!window.scrollY)},{passive:true});
window.addEventListener('touchend',()=>{if(!pa)return;pa=false;if(ptr.classList.contains('show')){ptr.classList.add('spin');now=new Date();render();setTimeout(()=>ptr.classList.remove('show','spin'),400)}},{passive:true});

/* === INIT === */
$('app').className=dir;
$('btnS').className=`seg-btn ${dir==='station'?'on':''}`;
$('btnM').className=`seg-btn ${dir==='mansion'?'on':''}`;
if('serviceWorker'in navigator)navigator.serviceWorker.register('sw.js').catch(()=>{});
render();
setTimeout(scrollNow,300);
setInterval(()=>{const p=now.getMinutes();now=new Date();updateClock();if(now.getMinutes()!==p)render()},1000);
</script>
</body>
</html>
